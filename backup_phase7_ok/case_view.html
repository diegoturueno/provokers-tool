<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHENOMA - Vista de Caso</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header class="main-header">
            <div class="logo"><a href="/">PHENOMA <span class="highlight">AI</span></a></div>

            <div class="mode-switch">
                <span id="mode-label" style="font-size: 0.8rem; color: #94a1b2;">Modo Local (Ollama)</span>
                <label class="switch">
                    <input type="checkbox" id="cloud-toggle">
                    <span class="slider round"></span>
                </label>
            </div>

            <div class="case-info-header">
                <span class="case-id" id="header-case-id">Cargando...</span>
                <span class="case-status">Fase 1: Inputs</span>
            </div>
        </header>

        <div class="case-layout">
            <aside class="sidebar">
                <nav class="phase-nav">
                    <a href="#" class="phase-link active" data-phase="1" onclick="switchPhase(1); return false;">
                        <span class="phase-num">1</span> Inputs
                    </a>
                    <a href="#" class="phase-link" data-phase="2" onclick="switchPhase(2); return false;">
                        <span class="phase-num">2</span> Patrones
                    </a>
                    <a href="#" class="phase-link" data-phase="3" onclick="switchPhase(3); return false;">
                        <span class="phase-num">3</span> Ejes
                    </a>
                    <a href="#" class="phase-link" data-phase="4" onclick="switchPhase(4); return false;">
                        <span class="phase-num">4</span> Dimensiones
                    </a>
                    <a href="#" class="phase-link" data-phase="5" onclick="switchPhase(5); return false;">
                        <span class="phase-num">5</span> Tensiones
                    </a>
                    <a href="#" class="phase-link" data-phase="6" onclick="switchPhase(6); return false;">
                        <span class="phase-num">6</span> Umbral
                    </a>
                    <a href="#" class="phase-link" data-phase="7" onclick="switchPhase(7); return false;">
                        <span class="phase-num">7</span> Arquetipo
                    </a>
                </nav>
            </aside>

            <main class="case-content">
                <!-- VISTA FASE 1: INPUTS -->
                <section id="phase-1-view">
                    <div class="section-header">
                        <h2>Inputs del Caso</h2>
                        <button id="add-input-btn" class="secondary-btn">+ Agregar Input</button>
                    </div>

                    <div id="inputs-list" class="inputs-list">
                        <!-- Lista de inputs -->
                    </div>

                    <!-- Formulario de Input (Oculto por defecto) -->
                    <div id="input-form-container" class="panel hidden">
                        <h3>Nuevo Input</h3>
                        <form id="new-input-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tipo</label>
                                    <select id="input-type">
                                        <option value="frase">Frase</option>
                                        <option value="discurso">Discurso</option>
                                        <option value="relato">Relato</option>
                                        <option value="situacion">Situaci√≥n</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Fecha</label>
                                    <input type="date" id="input-date">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Contenido</label>
                                <textarea id="input-content" rows="4" required></textarea>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="cancel-btn" id="cancel-input-btn">Cancelar</button>
                                <button type="submit" class="primary-btn">Guardar Input</button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- VISTA FASE 2: PATRONES -->
                <section id="phase-2-view" class="hidden">
                    <div class="section-header">
                        <h2>Detecci√≥n de Patrones</h2>
                        <button id="analyze-patterns-btn" class="primary-btn">
                            <span class="btn-text">‚ú® Detectar con IA</span>
                            <div class="loader"></div>
                        </button>
                    </div>

                    <div class="info-banner">
                        La IA analizar√° los inputs cargados para encontrar recurrencias y contradicciones.
                    </div>

                    <div id="patterns-list" class="patterns-grid">
                        <!-- Lista de patrones -->
                    </div>
                </section>

                <!-- VISTA FASE 3: EJES -->
                <section id="phase-3-view" class="hidden">
                    <div class="section-header">
                        <h2>Vinculaci√≥n con Ejes</h2>
                        <button id="auto-link-btn" class="primary-btn">
                            <span class="btn-text">üîó Vincular Autom√°ticamente</span>
                            <div class="loader"></div>
                        </button>
                    </div>

                    <div class="axes-grid" id="axes-container">
                        <!-- Se generar√°n 6 columnas, una por eje -->
                        <div class="axis-column" data-axis="Generaci√≥n">
                            <h3>Generaci√≥n</h3>
                            <div class="axis-content"></div>
                        </div>
                        <div class="axis-column" data-axis="Relaci√≥n con el cambio feminista">
                            <h3>Relaci√≥n Feminista</h3>
                            <div class="axis-content"></div>
                        </div>
                        <div class="axis-column" data-axis="Modelo de masculinidad">
                            <h3>Modelo Masculinidad</h3>
                            <div class="axis-content"></div>
                        </div>
                        <div class="axis-column" data-axis="Apertura a diversidad sexual y familiar">
                            <h3>Diversidad</h3>
                            <div class="axis-content"></div>
                        </div>
                        <div class="axis-column" data-axis="Manejo emocional y cuidado de s√≠">
                            <h3>Manejo Emocional</h3>
                            <div class="axis-content"></div>
                        </div>
                        <div class="axis-column" data-axis="Presi√≥n social / falta de referentes">
                            <h3>Presi√≥n Social</h3>
                            <div class="axis-content"></div>
                        </div>
                    </div>
                </section>

                <!-- VISTA FASE 4: DIMENSIONES -->
                <section id="phase-4-view" class="hidden">
                    <div class="section-header">
                        <h2>Clasificaci√≥n de Dimensiones</h2>
                        <button id="analyze-dimensions-btn" class="primary-btn">
                            <span class="btn-text">üìä Analizar Dimensiones</span>
                            <div class="loader"></div>
                        </button>
                    </div>

                    <div class="info-banner">
                        Determinaci√≥n del estado y valor de cada eje basado en las evidencias acumuladas.
                    </div>

                    <div class="dimensions-grid" id="dimensions-container">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </section>

                <!-- VISTA FASE 5: TENSIONES -->
                <section id="phase-5-view" class="hidden">
                    <div class="section-header">
                        <h2>Tensiones Estructurales</h2>
                        <button id="analyze-tensions-btn" class="primary-btn">
                            <span class="btn-text">‚ö° Detectar Tensiones</span>
                            <div class="loader"></div>
                        </button>
                    </div>

                    <div class="info-banner">
                        An√°lisis de contradicciones y paradojas entre los diferentes ejes del perfil.
                    </div>

                    <div class="tensions-list" id="tensions-container">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </section>

                <!-- VISTA FASE 6: UMBRAL -->
                <section id="phase-6-view" class="hidden">
                    <div class="section-header">
                        <h2>Evaluaci√≥n de Umbral</h2>
                        <button id="analyze-threshold-btn" class="primary-btn">
                            <span class="btn-text">‚öñÔ∏è Evaluar Viabilidad</span>
                            <div class="loader"></div>
                        </button>
                    </div>

                    <div class="info-banner">
                        Determinaci√≥n de la densidad y riqueza del caso para proceder al arquetipado.
                    </div>

                    <div id="threshold-container" class="threshold-container hidden">
                        <div class="score-card">
                            <div class="score-circle">
                                <span id="threshold-score">--</span>
                                <span class="score-label">Score</span>
                            </div>
                            <div class="status-badge" id="threshold-status">Pendiente</div>
                        </div>
                        <div class="reasoning-box">
                            <h3>Razonamiento de la IA</h3>
                            <p id="threshold-reasoning">...</p>
                        </div>
                    </div>
                </section>

                <!-- VISTA FASE 7: ARQUETIPO -->
                <section id="phase-7-view" class="hidden">
                    <div class="section-header">
                        <h2>Asignaci√≥n de Arquetipo</h2>
                        <button id="analyze-archetype-btn" class="primary-btn">
                            <span class="btn-text">üé≠ Definir Arquetipo</span>
                            <div class="loader"></div>
                        </button>
                    </div>

                    <div class="info-banner">
                        S√≠ntesis final del perfil de masculinidad basada en patrones, ejes y tensiones.
                    </div>

                    <div id="archetype-container" class="archetype-container hidden">
                        <div class="archetype-card-final">
                            <div class="arch-header">
                                <h1 id="arch-name">Nombre del Arquetipo</h1>
                                <div class="fit-badge">Fit: <span id="arch-fit">--</span>%</div>
                            </div>
                            <p class="arch-description" id="arch-desc">...</p>

                            <div class="traits-section">
                                <h4>Rasgos Clave</h4>
                                <div class="traits-list" id="arch-traits">
                                    <!-- Traits -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Script con ID del caso inyectado -->
    <script>
        const CURRENT_CASE_ID = {{ case_id }};
    </script>
    <script src="{{ url_for('static', filename='script.js') }}?v=16"></script>
</body>

</html>